<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ربات شکار میم‌کوین</title>

    <!-- Bootstrap CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

    <style>
        body {
            direction: rtl;
            background-color: #f8f9fa;
            padding: 20px;
            font-family: 'Vazir', sans-serif;
        }
        .card {
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .risk-badge {
            margin-left: 5px;
            font-size: 0.8rem;
        }
        .btn-watchlist {
            min-width: 140px;
        }
        .footer {
            margin-top: 30px;
            text-align: center;
            color: #666;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1 class="mb-4 text-center">ربات شکار میم‌کوین</h1>

        <p class="text-center text-muted">آخرین بروزرسانی: {{ last_updated or 'نامشخص' }}</p>

        {% if tokens|length == 0 %}
            <div class="alert alert-info text-center">توکنی یافت نشد.</div>
        {% else %}
            {% for token in tokens %}
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">
                        {{ token.token_name }} ({{ token.token_symbol }})
                    </h5>
                    <p class="card-text mb-1">
                        🌐 شبکه: <strong>{{ token.network }}</strong><br />
                        💰 نقدینگی: <strong>${{ '{:,.0f}'.format(token.liquidity) }}</strong><br />
                        📈 مارکت کپ: <strong>${{ '{:,.0f}'.format(token.market_cap) }}</strong><br />
                        ⏱ سن توکن: <strong>{{ token.age }} دقیقه</strong><br />
                        📊 حجم ۲۴ ساعت: <strong>${{ '{:,.0f}'.format(token.volume_24h) }}</strong><br />
                        📉 تغییر ۵ دقیقه: <strong>{{ token.price_change_5m }}%</strong><br />
                        🔗 آدرس توکن: <code>{{ token.address }}</code>
                    </p>

                    {% if token.risks and token.risks|length > 0 %}
                    <div class="mb-2">
                        <strong>ریسک‌ها:</strong>
                        {% for risk in token.risks %}
                            <span class="badge bg-danger risk-badge">{{ risk }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}

                    <button
                        class="btn btn-primary btn-watchlist"
                        onclick="addToWatchlist('{{ token.address }}', this)"
                    >افزودن به واچ‌لیست</button>
                </div>
            </div>
            {% endfor %}
        {% endif %}
    </div>

    <div class="footer">
        ربات شکار میم‌کوین © 2025
    </div>

    <!-- Bootstrap JS Bundle CDN (includes Popper) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        function addToWatchlist(address, btn) {
            btn.disabled = true;
            btn.textContent = 'در حال افزودن...';

            fetch('/watchlist', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({address: address})
            })
            .then(response => response.json())
            .then(data => {
                if(data.status === 'ok'){
                    btn.textContent = 'افزوده شد ✔';
                    btn.classList.remove('btn-primary');
                    btn.classList.add('btn-success');
                } else {
                    btn.textContent = 'خطا! دوباره تلاش کنید';
                    btn.disabled = false;
                }
            })
            .catch(() => {
                btn.textContent = 'خطا! دوباره تلاش کنید';
                btn.disabled = false;
            });
        }
    </script>
</body>
</html>
