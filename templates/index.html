<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Ø±Ø¨Ø§Øª Ø´Ú©Ø§Ø± Ù…ÛŒÙ…â€ŒÚ©ÙˆÛŒÙ†</title>

    <!-- Bootstrap CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

    <style>
        body {
            direction: rtl;
            background-color: #f8f9fa;
            padding: 20px;
            font-family: 'Vazir', sans-serif;
        }
        .card {
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .risk-badge {
            margin-left: 5px;
            font-size: 0.8rem;
        }
        .btn-watchlist {
            min-width: 140px;
        }
        .footer {
            margin-top: 30px;
            text-align: center;
            color: #666;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1 class="mb-4 text-center">Ø±Ø¨Ø§Øª Ø´Ú©Ø§Ø± Ù…ÛŒÙ…â€ŒÚ©ÙˆÛŒÙ†</h1>

        <p class="text-center text-muted">Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: {{ last_updated or 'Ù†Ø§Ù…Ø´Ø®Øµ' }}</p>

        {% if tokens|length == 0 %}
            <div class="alert alert-info text-center">ØªÙˆÚ©Ù†ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</div>
        {% else %}
            {% for token in tokens %}
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">
                        {{ token.token_name }} ({{ token.token_symbol }})
                    </h5>
                    <p class="card-text mb-1">
                        ğŸŒ Ø´Ø¨Ú©Ù‡: <strong>{{ token.network }}</strong><br />
                        ğŸ’° Ù†Ù‚Ø¯ÛŒÙ†Ú¯ÛŒ: <strong>${{ '{:,.0f}'.format(token.liquidity) }}</strong><br />
                        ğŸ“ˆ Ù…Ø§Ø±Ú©Øª Ú©Ù¾: <strong>${{ '{:,.0f}'.format(token.market_cap) }}</strong><br />
                        â± Ø³Ù† ØªÙˆÚ©Ù†: <strong>{{ token.age }} Ø¯Ù‚ÛŒÙ‚Ù‡</strong><br />
                        ğŸ“Š Ø­Ø¬Ù… Û²Û´ Ø³Ø§Ø¹Øª: <strong>${{ '{:,.0f}'.format(token.volume_24h) }}</strong><br />
                        ğŸ“‰ ØªØºÛŒÛŒØ± Ûµ Ø¯Ù‚ÛŒÙ‚Ù‡: <strong>{{ token.price_change_5m }}%</strong><br />
                        ğŸ”— Ø¢Ø¯Ø±Ø³ ØªÙˆÚ©Ù†: <code>{{ token.address }}</code>
                    </p>

                    {% if token.risks and token.risks|length > 0 %}
                    <div class="mb-2">
                        <strong>Ø±ÛŒØ³Ú©â€ŒÙ‡Ø§:</strong>
                        {% for risk in token.risks %}
                            <span class="badge bg-danger risk-badge">{{ risk }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}

                    <button
                        class="btn btn-primary btn-watchlist"
                        onclick="addToWatchlist('{{ token.address }}', this)"
                    >Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ ÙˆØ§Ú†â€ŒÙ„ÛŒØ³Øª</button>
                </div>
            </div>
            {% endfor %}
        {% endif %}
    </div>

    <div class="footer">
        Ø±Ø¨Ø§Øª Ø´Ú©Ø§Ø± Ù…ÛŒÙ…â€ŒÚ©ÙˆÛŒÙ† Â© 2025
    </div>

    <!-- Bootstrap JS Bundle CDN (includes Popper) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        function addToWatchlist(address, btn) {
            btn.disabled = true;
            btn.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø§ÙØ²ÙˆØ¯Ù†...';

            fetch('/watchlist', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({address: address})
            })
            .then(response => response.json())
            .then(data => {
                if(data.status === 'ok'){
                    btn.textContent = 'Ø§ÙØ²ÙˆØ¯Ù‡ Ø´Ø¯ âœ”';
                    btn.classList.remove('btn-primary');
                    btn.classList.add('btn-success');
                } else {
                    btn.textContent = 'Ø®Ø·Ø§! Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯';
                    btn.disabled = false;
                }
            })
            .catch(() => {
                btn.textContent = 'Ø®Ø·Ø§! Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯';
                btn.disabled = false;
            });
        }
    </script>
</body>
</html>
